var PCA=function(){function r(r){return i(r,u(a(l(r.length),r),1/r.length))}function n(r){return a(h(r),r)}function t(r,n){return u(r,n?1/(r.length-1):1/r.length)}function o(r){var n=svd(r);console.log(n);var t=n.U;return n.S.map(function(r,n){var o={};return o.eigenvalue=r,o.vector=t.map(function(r,t){return-1*r[n]}),o})}function e(n,...t){var o=r(n),e=(h(t),a(t,o)),f=u(a(l(n.length),n),-1/n.length),c=f.filter(function(r,n){return n<e.length});console.log("avg data and reduced data",f,c),console.log("final without mean",e);var s=i(e,c);return{finalWithoutMean:e,finalWithMean:s}}function f(e){return o(t(n(r(e)),!1))}function a(r,n){if(!(r[0]&&n[0]&&r.length&&n.length))throw new Error("Both A and B should be matrices");if(n.length!==r[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var t=[],o=0;o<r.length;o++){t[o]=[];for(var e=0;e<n[0].length;e++)for(var f=0;f<r[0].length;f++)t[o][e]=t[o][e]?t[o][e]+r[o][f]*n[f][e]:r[o][f]*n[f][e]}return t}function i(r,n){if(r.length!==n.length||r[0].length!==n[0].length)throw new Error("Both A and B should have the same dimensions");for(var t=[],o=0;o<r.length;o++){t[o]=[];for(var e=0;e<n[0].length;e++)t[o][e]=r[o][e]-n[o][e]}return t}function u(r,n){for(var t=[],o=0;o<r.length;o++){t[o]=[];for(var e=0;e<r[0].length;e++)t[o][e]=r[o][e]*n}return t}function l(r){for(var n=[],t=0;t<r;t++){n[t]=[];for(var o=0;o<r;o++)n[t][o]=1}return n}function h(r){return c(r)[0].map(function(n,t){return r.map(function(r){return r[t]})})}function c(r){var n=JSON.stringify(r);return JSON.parse(n)}return{computeDeviationScores:n,computeDeviationMatrix:r,computeSVD:o,computeVarianceCovariance:t,computeAdjustedData:e,getEigenVectors:f,analyseTopResult:function(r){var n=f(r).sort(function(r,n){return n.eigenvalue-r.eigenvalue});return console.log("Sorted Vectors",n),e(r,n[0].vector)},transpose:h,multiply:a,clone:c,scale:u}}();function svd(r){var n,t=Math.pow(2,-52),o=1e-64/t,e=0,f=0,a=0,i=0,u=0,l=clone(r),h=l.length,c=l[0].length;if(h<c)throw"Need more rows than columns";var s=new Array(c),g=new Array(c);for(f=0;f<c;f++)s[f]=g[f]=0;var v=function r(n,t,o){void 0===o&&(o=0);var e,f=n[o],a=Array(f);if(o===n.length-1){for(e=f-2;e>=0;e-=2)a[e+1]=t,a[e]=t;return-1===e&&(a[0]=t),a}for(e=f-1;e>=0;e--)a[e]=r(n,t,o+1);return a}([c,c],0);function m(r,n){return(r=Math.abs(r))>(n=Math.abs(n))?r*Math.sqrt(1+n*n/r/r):0==n?r:n*Math.sqrt(1+r*r/n/n)}var d=0,p=0,M=0,w=0,b=0,S=0,A=0;for(f=0;f<c;f++){for(s[f]=p,A=0,u=f+1,a=f;a<h;a++)A+=l[a][f]*l[a][f];if(A<=o)p=0;else for(d=l[f][f],p=Math.sqrt(A),d>=0&&(p=-p),M=d*p-A,l[f][f]=d-p,a=u;a<c;a++){for(A=0,i=f;i<h;i++)A+=l[i][f]*l[i][a];for(d=A/M,i=f;i<h;i++)l[i][a]+=d*l[i][f]}for(g[f]=p,A=0,a=u;a<c;a++)A+=l[f][a]*l[f][a];if(A<=o)p=0;else{for(d=l[f][f+1],p=Math.sqrt(A),d>=0&&(p=-p),M=d*p-A,l[f][f+1]=d-p,a=u;a<c;a++)s[a]=l[f][a]/M;for(a=u;a<h;a++){for(A=0,i=u;i<c;i++)A+=l[a][i]*l[f][i];for(i=u;i<c;i++)l[a][i]+=A*s[i]}}(b=Math.abs(g[f])+Math.abs(s[f]))>w&&(w=b)}for(f=c-1;-1!=f;f+=-1){if(0!=p){for(M=p*l[f][f+1],a=u;a<c;a++)v[a][f]=l[f][a]/M;for(a=u;a<c;a++){for(A=0,i=u;i<c;i++)A+=l[f][i]*v[i][a];for(i=u;i<c;i++)v[i][a]+=A*v[i][f]}}for(a=u;a<c;a++)v[f][a]=0,v[a][f]=0;v[f][f]=1,p=s[f],u=f}for(f=c-1;-1!=f;f+=-1){for(u=f+1,p=g[f],a=u;a<c;a++)l[f][a]=0;if(0!=p){for(M=l[f][f]*p,a=u;a<c;a++){for(A=0,i=u;i<h;i++)A+=l[i][f]*l[i][a];for(d=A/M,i=f;i<h;i++)l[i][a]+=d*l[i][f]}for(a=f;a<h;a++)l[a][f]=l[a][f]/p}else for(a=f;a<h;a++)l[a][f]=0;l[f][f]+=1}for(t*=w,i=c-1;-1!=i;i+=-1)for(var y=0;y<50;y++){var B=!1;for(u=i;-1!=u;u+=-1){if(Math.abs(s[u])<=t){B=!0;break}if(Math.abs(g[u-1])<=t)break}if(!B){e=0,A=1;var E=u-1;for(f=u;f<i+1&&(d=A*s[f],s[f]=e*s[f],!(Math.abs(d)<=t));f++)for(M=m(d,p=g[f]),g[f]=M,e=p/M,A=-d/M,a=0;a<h;a++)b=l[a][E],S=l[a][f],l[a][E]=b*e+S*A,l[a][f]=-b*A+S*e}if(S=g[i],u==i){if(S<0)for(g[i]=-S,a=0;a<c;a++)v[a][i]=-v[a][i];break}if(y>=49)throw"Error: no convergence.";for(w=g[u],p=m(d=(((b=g[i-1])-S)*(b+S)+((p=s[i-1])-(M=s[i]))*(p+M))/(2*M*b),1),d=d<0?((w-S)*(w+S)+M*(b/(d-p)-M))/w:((w-S)*(w+S)+M*(b/(d+p)-M))/w,e=1,A=1,f=u+1;f<i+1;f++){for(p=s[f],b=g[f],M=A*p,p*=e,S=m(d,M),s[f-1]=S,d=w*(e=d/S)+p*(A=M/S),p=-w*A+p*e,M=b*A,b*=e,a=0;a<c;a++)w=v[a][f-1],S=v[a][f],v[a][f-1]=w*e+S*A,v[a][f]=-w*A+S*e;for(S=m(d,M),g[f-1]=S,d=(e=d/S)*p+(A=M/S)*b,w=-A*p+e*b,a=0;a<h;a++)b=l[a][f-1],S=l[a][f],l[a][f-1]=b*e+S*A,l[a][f]=-b*A+S*e}s[u]=0,s[i]=d,g[i]=w}for(f=0;f<g.length;f++)g[f]<t&&(g[f]=0);for(f=0;f<c;f++)for(a=f-1;a>=0;a--)if(g[a]<g[f]){for(e=g[a],g[a]=g[f],g[f]=e,i=0;i<l.length;i++)n=l[i][f],l[i][f]=l[i][a],l[i][a]=n;for(i=0;i<v.length;i++)n=v[i][f],v[i][f]=v[i][a],v[i][a]=n;f=a}return{U:l,S:g,V:v}}function clone(r){var n=JSON.stringify(r);return JSON.parse(n)}